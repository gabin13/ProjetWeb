{% extends "base_demandes.html" %}

{% block body %}


<div class="container custom-container">
    <h2>Mes Demandes</h2>
    
    {% set statusDescriptions = {1: 'En attente', 2: 'En cours', 3: 'Terminée', 4: 'Clôturée'} %}
    {% set imagesByTitle = {
        "Installation de panneaux solaires": "images/Panneauxsolaires.png",
        "Entretien du chauffage": "images/Chauffage.png",
        "Isolation des combles": "images/combles.png",
        "Réparation des conduites d'air": "images/ConduitsAir.png",
        "Isolation des tuyaux de plomberie": "images/IsolationTuyaux.png",
        "Réparation des radiateurs": "images/Radiateurs.png"
    } %}
    
    
    {% if session.user.Role == 'Intervenant' %}
    {% for statusID, statusName in statusDescriptions %}
    <div class="statut-titre">{{ statusName }}</div>
    <div class="row">
        {% set found = false %}
        {% for intervention in interventions %}
            {% if intervention.StatusID == statusID %}
                {% set found = true %}
                <div class="col-md-4">
                    <div class="service-card" data-title="{{ intervention.Title }}" data-img="{{ imagesByTitle[intervention.Title]|default('path/to/default.jpg') }}" data-detail="{{ intervention.Description }}" data-status="{{ statusDescriptions[intervention.StatusID] }}" data-intervention-id="{{ intervention.ID }}">
                        <h3>{{ intervention.Title }}</h3>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
        {% if not found %}
            <p class="aucune-intervention col-12">Aucune intervention pour "{{ statusName }}"</p>
        {% endif %}
    </div>
{% endfor %}
{% else %}
        {% for statusID, statusName in statusDescriptions %}
            <div class="statut-titre">{{ statusName }}</div>
            <div class="row">
                {% set found = false %}
                {% for intervention in interventions %}
                    {% if intervention.StatusID == statusID %}
                        {% set found = true %}
                        <div class="col-md-4">
                            <div class="service-card open-modal" data-title="{{ intervention.Title }}" data-img="{{ imagesByTitle[intervention.Title]|default('path/to/default.jpg') }}" data-detail="{{ intervention.Description }}" data-status="{{ statusDescriptions[intervention.StatusID] }}" data-intervention-id="{{ intervention.ID }}">
                                <h3>{{ intervention.Title }}</h3>
                            </div>
                        </div>
                    {% endif %}
                {% endfor %}
                {% if not found %}
                    <p class="aucune-intervention col-12">Aucune intervention pour "{{ statusName }}"</p>
                {% endif %}
            </div>
        {% endfor %}
    {% endif %}
    <div class="modal fade" id="serviceModal" tabindex="-1" role="dialog" aria-labelledby="serviceModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="serviceModalLabel">Titre du Service</h5>
              <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
            <div class="modal-body">
              <img id="serviceImage" src="" alt="Service" style="width:100%;">
              <div class="separator"></div>
              <p id="serviceDetail"></p>
              <!-- Ligne ajoutée pour le numéro de téléphone -->
              
            </div>
          </div>
        </div>
      </div>


  <!-- Modal pour laisser un commentaire -->
<div class="modal fade" id="commentModal" tabindex="-1" role="dialog" aria-labelledby="commentModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="commentModalLabel">Laisser un commentaire</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form action="submit_comment.php" method="post">
          <div class="form-group">
              <label for="CommentText">Votre commentaire</label>
              <textarea class="form-control" id="CommentText" name="CommentText" rows="3" required></textarea>
          </div>
          <input type="hidden" id="InterventionIdForComment" name="InterventionID">
          <button type="submit" class="btn btn-primary">Envoyer le commentaire</button>
      </form>
      </div> 
    </div>
  </div>
</div>


{% endblock %}