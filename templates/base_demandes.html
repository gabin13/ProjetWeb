<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accord Energie | {% block title %}{% endblock %} </title>
    <link rel="stylesheet" href="/styles/demandes.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSLFuWqE2R4M36JzGTVsDJ0ScU6Ew2yGpB01N8" crossorigin="anonymous">


</head>

    <body>


    <div class="container">

        <nav>
            <div class="logo">
                <!-- Mettez à jour le chemin dans href selon la structure de votre site -->
                <a href="/">
                    <img src="/images/logo.jpg" alt="Logo AccordEnergie" style="height: 50px;"> AccordEnergie
                </a>
            </div>
            <ul>
                {% if session.user %}
                    <li><a href="/mes_demandes.php">Mes demandes</a></li>
                    <li><a href="/logout.php">Déconnexion</a></li>
                {% else %}
                    <li><a href="/">Accueil</a></li>
                    <li><a href="/login.php">Connexion</a></li>
                    <li><a href="/register.php">Inscription</a></li>
                {% endif %}
            </ul>
        </nav>
        

    </div>

        {% block body %}{% endblock %} 

        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9FqFbzBQzYRJ6x0tJWQHrY7EgCneDhMvkM+6G5IjE5Lm5QlbH4wYL5LP" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8sh+RWAAcGihEdARBgIvZeXklV7O+GLD8qhqu8" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

<script>
    document.querySelectorAll('.service-card').forEach(card => {
        const imageUrl = card.getAttribute('data-img');
        card.style.backgroundImage = `url('${imageUrl}')`;
    });

    $(document).ready(function(){
        $('.service-card').click(function(){
            var title = $(this).data('title');
            var img = $(this).data('img');
            var detail = $(this).data('detail');
            var status = $(this).data('status');

            $('#serviceModalLabel').text(title);
            $('#serviceImage').attr('src', img);
            $('#serviceDetail').html(`<strong>Description:</strong> ${detail}<br><strong>Status:</strong> ${status}`);

            // Ajoutez le bouton de commentaire si le statut est 'Clôturée'
            if (status === 'Clôturée') {
                var commentButton = `<div class="d-flex justify-content-end mt-2">
                                        <button type="button" class="btn btn-primary btn-sm" id="leaveComment">Laisser un commentaire</button>
                                      </div>`;
                $('#serviceDetail').append(commentButton);
            }

            $('#serviceModal').modal('show');
    });

    $(document).ready(function(){
    // Correction de la récupération de l'ID d'intervention
    $(document).on('click', '#leaveComment', function(){
    var interventionId = $(this).closest('.service-card').data('interventionId'); 
    console.log(interventionId); // Ajoutez cette ligne pour le débogage
    $('#InterventionIdForComment').val(interventionId);
    $('#commentModal').modal('show');
});


    // Gestion de la soumission du formulaire de commentaire
    
});

$(document).ready(function() {
    // Gestion du clic sur les cartes de service pour ouvrir le modal de détails
    $('.service-card').click(function() {
        var title = $(this).data('title');
        var img = $(this).data('img');
        var detail = $(this).data('detail');
        var status = $(this).data('status');

        $('#serviceModalLabel').text(title);
        $('#serviceImage').attr('src', img);
        $('#serviceDetail').html(`<strong>Description:</strong> ${detail}<br><strong>Status:</strong> ${status}`);

        // Afficher ou non le bouton de commentaire basé sur le statut
        if (status === 'Clôturée') {
            $('#leaveComment').remove(); // Supprime un éventuel bouton existant pour éviter les duplications
            var commentButton = `<button type="button" class="btn btn-primary btn-sm open-comment-modal" data-intervention-id="${$(this).data('intervention-id')}">Laisser un commentaire</button>`;
            $('#serviceDetail').append(commentButton);
        }

        $('#serviceModal').modal('show');
    });

    // Gestion de l'ouverture du modal de commentaire et passage de l'ID d'intervention
    $(document).ready(function() {
    // Assurez-vous que les sélecteurs correspondent à ceux de vos boutons pour ouvrir le modal de commentaire.
    $(document).on('click', '.open-comment-modal', function() {
        var interventionId = $(this).data('intervention-id');
    console.log("Intervention ID récupéré pour le commentaire:", interventionId); // Pour le débogage
    $('#InterventionIdForComment').val(interventionId);
    $('#commentModal').modal('show');
    });
});

});




});

</script>
</body>
</html>